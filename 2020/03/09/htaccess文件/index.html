<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="htaccess文件小记"><meta name="keywords" content="其他"><meta name="author" content="littlefisher,undefined"><meta name="copyright" content="littlefisher"><title>htaccess文件小记 | littlefisher</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.4"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是-htaccess文件"><span class="toc-number">1.</span> <span class="toc-text">什么是.htaccess文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工作机制"><span class="toc-number">2.</span> <span class="toc-text">工作机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优缺点"><span class="toc-number">3.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用途"><span class="toc-number">4.</span> <span class="toc-text">用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用范例"><span class="toc-number">5.</span> <span class="toc-text">使用范例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置错误页面"><span class="toc-number">5.1.</span> <span class="toc-text">设置错误页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置重定向"><span class="toc-number">5.2.</span> <span class="toc-text">设置重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#禁止指定IP访问"><span class="toc-number">5.3.</span> <span class="toc-text">禁止指定IP访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#禁止指定来源访问"><span class="toc-number">5.4.</span> <span class="toc-text">禁止指定来源访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件防盗链"><span class="toc-number">5.5.</span> <span class="toc-text">文件防盗链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#禁用文件夹列表"><span class="toc-number">5.6.</span> <span class="toc-text">禁用文件夹列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置文件夹首页"><span class="toc-number">5.7.</span> <span class="toc-text">设置文件夹首页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置媒体文件为可下载的而非播放"><span class="toc-number">5.8.</span> <span class="toc-text">设置媒体文件为可下载的而非播放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义-HTTP-报头"><span class="toc-number">5.9.</span> <span class="toc-text">自定义 HTTP 报头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置文件过期时间-Cache-Control"><span class="toc-number">5.10.</span> <span class="toc-text">设置文件过期时间 Cache Control</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">littlefisher</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">16</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">7</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://119.29.91.207/mianma.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">littlefisher</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span></div><div id="post-info"><div id="post-title">htaccess文件小记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-09</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>我就不说我是多么多么多么懒得上传有图片的内容的了。因为是刚学完.htaccess文件解析漏洞，又正好看到了有关.htaccess文件的文章，就有了这篇小记。至于Apache解析漏洞环境搭建及复现，等啥时候也会陆续放上来。</p>
<a id="more"></a>
<h2 id="什么是-htaccess文件"><a href="#什么是-htaccess文件" class="headerlink" title="什么是.htaccess文件"></a>什么是.htaccess文件</h2><p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。（全称是Hypertext Access,超文本入口。提供了针对目录改变配置的方法，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。）</p>
<h2 id="工作机制"><a href="#工作机制" class="headerlink" title="工作机制"></a>工作机制</h2><p>Apache在所有上级的目录中查找.htaccess文件，以使所有有效的指令都起作用。所以，如果请求/www/htdocs/example中的页面，Apache必须查找以下文件，即使这些文件都不存在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/.htaccess</span><br><span class="line">/www/.htaccess</span><br><span class="line">/www/htdocs/.htaccess</span><br><span class="line">/www/htdocs/example/.htaccess</span><br></pre></td></tr></table></figure>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>优点：利用当前目录的.htaccess文件可以允许管理员灵活的随时按需改变目录访问策略。<br>缺点：1.性能：Apache必须在所有上级的目录中查找.htaccess文件，对每一个请求都需要读取一次.htaccess文件,降低服务器性能；2.安全：这样会允许用户自己修改服务器的配置，这可能会导致某些意想不到的修改。</p>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>通过htaccess文件，可以实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档、防盗链等。</p>
<h2 id="使用范例"><a href="#使用范例" class="headerlink" title="使用范例"></a>使用范例</h2><h3 id="设置错误页面"><a href="#设置错误页面" class="headerlink" title="设置错误页面"></a>设置错误页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ErrorDocument 400 /error_pages/400.html</span><br><span class="line">ErrorDocument 401 /error_pages/401.html</span><br><span class="line">ErrorDocument 403 /error_pages/403.html</span><br><span class="line">ErrorDocument 404 /error_pages/404.html</span><br><span class="line">ErrorDocument 500 /error_pages/500.html</span><br></pre></td></tr></table></figure>
<h3 id="设置重定向"><a href="#设置重定向" class="headerlink" title="设置重定向"></a>设置重定向</h3><ol>
<li>从old_dir目录重定向到 new_dir 目录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redirect /old_dir/ http://www.domain.com/new_dir/index.html</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>把通过二级目录访问的请求301重定向到二级域名</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RedirectMatch 301 /dir/(.*) http://dir.domain.com/$1</span><br></pre></td></tr></table></figure>
<h3 id="禁止指定IP访问"><a href="#禁止指定IP访问" class="headerlink" title="禁止指定IP访问"></a>禁止指定IP访问</h3><ul>
<li>禁止 IP 为 255.0.0.0 和 123.45.6.区段的 IP 访问</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">order allow,deny</span><br><span class="line">deny from 255.0.0.0</span><br><span class="line">deny from 123.45.6.</span><br><span class="line">allow from all</span><br></pre></td></tr></table></figure>
<h3 id="禁止指定来源访问"><a href="#禁止指定来源访问" class="headerlink" title="禁止指定来源访问"></a>禁止指定来源访问</h3><ul>
<li>禁止从 otherdomain.com 和 anotherdomain.com 的来源访问</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine on</span><br><span class="line">RewriteCond %&#123;HTTP_REFERER&#125; otherdomain\.com [NC,OR]</span><br><span class="line">RewriteCond %&#123;HTTP_REFERER&#125; anotherdomain\.com</span><br><span class="line">RewriteRule .* - [F]</span><br></pre></td></tr></table></figure>
<h3 id="文件防盗链"><a href="#文件防盗链" class="headerlink" title="文件防盗链"></a>文件防盗链</h3><ul>
<li>从本站以外的域名访问图片，一律显示 feed.jpg</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine on</span><br><span class="line">判断HTTP_REFERER不空:</span><br><span class="line">RewriteCond %&#123;HTTP_REFERER&#125; !^$</span><br><span class="line">断来源是否来自自己的域,[NC]为忽略大小写:</span><br><span class="line">RewriteCond %&#123;HTTP_REFERER&#125; !^http://(www\.)?domain.com/.*$ [NC]</span><br><span class="line">将链接尾部为gif、jpg、png的定向到http://www.domain.com/feed.jpg，R为redirect 意义为强制重定向:</span><br><span class="line">RewriteRule \.(gif|jpg|png)$ http://www.domain.com/feed.jpg [R,L]</span><br></pre></td></tr></table></figure>
<h3 id="禁用文件夹列表"><a href="#禁用文件夹列表" class="headerlink" title="禁用文件夹列表"></a>禁用文件夹列表</h3><ul>
<li>禁用文件列表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndexIgnore *</span><br></pre></td></tr></table></figure>
<ul>
<li>仅不显示 .zip/.jpg/.gif 格式的文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IndexIgnore *.zip *.jpg *.gif</span><br></pre></td></tr></table></figure>
<h3 id="设置文件夹首页"><a href="#设置文件夹首页" class="headerlink" title="设置文件夹首页"></a>设置文件夹首页</h3><ul>
<li>防止显示文件夹列表，当访问文件夹时，服务器查找 index.html 为首页文件，如不存在依次向后查找</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DirectoryIndex index.html index.cgi index.php</span><br></pre></td></tr></table></figure>
<h3 id="设置媒体文件为可下载的而非播放"><a href="#设置媒体文件为可下载的而非播放" class="headerlink" title="设置媒体文件为可下载的而非播放"></a>设置媒体文件为可下载的而非播放</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/octet-stream .mp3 .mp4</span><br></pre></td></tr></table></figure>
<h3 id="自定义-HTTP-报头"><a href="#自定义-HTTP-报头" class="headerlink" title="自定义 HTTP 报头"></a>自定义 HTTP 报头</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Header set X-Pingback &quot;http://www.domain.com/xxxx.php&quot;</span><br><span class="line">Header set article-by &quot;xxxx.com&quot;</span><br></pre></td></tr></table></figure>
<h3 id="设置文件过期时间-Cache-Control"><a href="#设置文件过期时间-Cache-Control" class="headerlink" title="设置文件过期时间 Cache Control"></a>设置文件过期时间 Cache Control</h3><ul>
<li>启用有效期控制</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExpiresActive On</span><br></pre></td></tr></table></figure>
<ul>
<li>gif/png/jpg 有效期为1个月</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExpiresByType image/gif &quot;access plus 1 month&quot;</span><br><span class="line">ExpiresByType image/png &quot;access plus 1 month&quot;</span><br><span class="line">ExpiresByType image/jpg &quot;access plus 1 month&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>js/css 有效期为1星期</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExpiresByType text/javascript &quot;access plus 1 week&quot;</span><br><span class="line">ExpiresByType text/css &quot;access plus 1 week&quot;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">littlefisher</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/03/09/htaccess文件/">http://yoursite.com/2020/03/09/htaccess文件/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/其他/">其他</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2020/02/28/Nginx解析漏洞搭建及复现/"><span>Nginx解析漏洞环境搭建及复现</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2021 By littlefisher</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.4"></script><script src="/js/fancybox.js?version=1.5.4"></script><script src="/js/sidebar.js?version=1.5.4"></script><script src="/js/copy.js?version=1.5.4"></script><script src="/js/fireworks.js?version=1.5.4"></script><script src="/js/transition.js?version=1.5.4"></script><script src="/js/scroll.js?version=1.5.4"></script><script src="/js/head.js?version=1.5.4"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":"z16","width":150,"height":300,"scaling":1,"opacityDefault":0.7,"opacityHover":1,"mobileShow":true,"mobileScaling":0.5,"position":"right","horizontalOffset":0,"verticalOffset":-20,"id":"live2dcanvas","deviceJsSource":"local","pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/"});</script></body></html>